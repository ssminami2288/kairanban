<%= form_with(model: @post, local: true) do |form| %>
  <div>
    <%= form.label :date, '日付' %>
    <%= form.date_field :date %>
  </div>
  <br>
  <div>
    <%= form.label :title, 'タイトル' %>
    <%= form.text_field :title %>
  </div>
  <br>
  <div class="form-group">
    <%= form.label :text, '内容' %>
    <%= form.text_area :text %>
  </div>
  <br>
  <% if @post.pdfs.attached? %>
    <div class="attached-files">
      <% @post.pdfs.each do |pdf| %>
        <div>
          <%= link_to pdf.filename, rails_blob_path(pdf, disposition: "attachment") %>
          <%= form.hidden_field :existing_pdfs, value: pdf.signed_id %>
        </div>
      <% end %>
    </div>
  <% end %>
  <div>
    <%= form.label :pdfs, 'ファイルを添付' %>
  </div>
  <div class="file-group">
    <%= form.file_field :pdfs, multiple: true, accept: 'application/pdf' %>
  </div>
  <br>
</form>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var form = document.querySelector('form');

    form.addEventListener('submit', function(event) {
      event.preventDefault();
      var formData = new FormData(form);
      fetch(form.action, {
        method: form.method,
        body: formData
      }).then(function(response) {
        if (response.ok) {
          window.location.href = response.url;
        } else {
          alert('更新に失敗しました。');
        }
      }).catch(function(error) {
        alert('エラーが発生しました。');
      });
    });
  });
</script>